class t{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}move(t,e){this.x+=t,this.y+=e}add(e){return new t(this.x+e.x,this.y+e.y)}sub(e){return new t(this.x-e.x,this.y-e.y)}mul(e){return new t(this.x*e,this.y*e)}get angle(){return Math.atan2(this.y,this.x)}get unit(){return this.mul(1/this.length)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}set length(t){let e=this.unit.mul(t);this.set(e.x,e.y)}clone(){return new t(this.x,this.y)}toString(){return`(${this.x},${this.y})`}equal(t){return this.x===t.x&&this.y===t.y}}class e{constructor(e){this.dead=!1,e?(this.p=e.p,this.r=e.r,this.color=e.color,this.v=e.v||new t,this.a=e.a||new t):(this.p=new t,this.v=new t,this.a=new t,this.r=10,this.color="#fff")}[Symbol.toStringTag](){return this.type}get width(){return 2*this.r}get height(){return this.width}get type(){return"Particle"}draw(t){t.save(),t.beginPath(),t.translate(this.p.x,this.p.y),t.arc(0,0,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.restore()}}class n{constructor(t){this.p=t,this.value=-100}affect(t){let e=t.p.sub(this.p),n=this.value/(1+e.length),a=e.unit.mul(n);t.v.move(a.x,a.y)}draw(t){t.save(),t.beginPath(),t.translate(this.p.x,this.p.y),t.arc(0,0,Math.sqrt(Math.abs(this.value)),0,2*Math.PI),t.fillStyle="#fff",t.fill(),t.restore()}}const a={r:255,g:255,b:150},i={r:1,g:a.g/15,b:a.b/15},r=Object.freeze({interval:15,maximum:a,count:i,total:i.r*(i.g+1)*(i.b+1)});function o(t,e,n){return"#"+t.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")}const h=new Map,s=new Set,d=[],c=new t,l={count:3,randomV:15,randomR:30,ay:.2,fade:.96,total:s.size,clearForcefield:function(){d.length=0,m.clearRect(0,0,f.width,f.height)}},u=document.createElement("canvas"),w=u.getContext("2d"),f=document.createElement("canvas"),m=f.getContext("2d");(async()=>{f.width=innerWidth,f.height=innerWidth,u.width=innerWidth,u.height=innerHeight,document.body.appendChild(f),document.body.appendChild(u),await async function(){const n=document.createElement("canvas"),a=n.getContext("2d");n.width=64,n.height=64;const i=.5*n.width,s=new e({p:new t(i,i),r:.5*n.width,color:"#fff"}),d=r.maximum;let[c,l,u]=[255,0,0];const w="createImageBitmap"in window;s.draw(a);for(;l<=d.g;){for(;u<d.b;)await f(a,s,c,l,u),u+=15;await f(a,s,c,l,u),u=0,l+=15}async function f(t,e,a,i,r){t.clearRect(0,0,n.width,n.height);const s=o(a,i,r);if(e.color=s,e.draw(t),w){const t=await createImageBitmap(n);h.set(s,t)}else{const t=await function(t){return new Promise((e=>{const n=new Image;n.addEventListener("load",(()=>{URL.revokeObjectURL(n.src),e(n)}),{once:!0}),t.toBlob((t=>{n.src=URL.createObjectURL(t)}))}))}(n);h.set(s,t)}}}(),requestAnimationFrame(v),setInterval(x,20),window.addEventListener("dblclick",M),window.addEventListener("mousemove",(t=>{c.set(t.x,t.y)})),window.addEventListener("resize",(t=>{u.width=innerWidth,u.height=innerHeight,f.width=innerWidth,f.height=innerHeight,function(){m.clearRect(0,0,f.width,f.height);for(const t of d)t.draw(m)}()}))})();const g=new dat.GUI;g.add(l,"count",0,30).step(1),g.add(l,"randomV",0,30).step(1),g.add(l,"randomR",0,50).step(1),g.add(l,"ay",-1,1).step(.01),g.add(l,"fade",0,.99).step(.01);const p=g.add(l,"total",0,5e3);g.add(l,"clearForcefield");const y=new Stats;function v(){w.clearRect(0,0,u.width,u.height);for(const t of s){const e=h.get(t.color);w.drawImage(e,0,0,e.width,e.height,Math.floor(t.p.x),Math.floor(t.p.y),Math.floor(t.width),Math.floor(t.height))}y.update(),requestAnimationFrame(v)}function x(){for(const t of s)if(b(t),t.dead)s.delete(t);else for(const e of d)e.affect(t);for(let n=l.count;n>0;n--){const n={p:c.clone(),v:new t(Math.random()*l.randomV-l.randomV/2,Math.random()*l.randomV-l.randomV/2),r:Math.random()*l.randomR,color:o(255,15*Math.floor(17*Math.random()),15*Math.floor(10*Math.random()))},a=new e(n);if(b(a),a.dead)s.delete(a);else{for(const t of d)t.affect(a);s.add(a)}}l.total=s.size,p.updateDisplay()}function b(t){t.r*=l.fade,t.r<.1?t.dead=!0:(t.p=t.p.add(t.v),t.v=t.v.add(t.a),t.v.move(0,l.ay),t.v=t.v.mul(.99),t.p.y+t.r>u.height&&(t.v.y=-Math.abs(t.v.y)),t.p.x+t.r>u.width&&(t.v.x=-Math.abs(t.v.x)),t.p.y-t.r<0&&(t.v.y=Math.abs(t.v.y)),t.p.x-t.r<0&&(t.v.x=Math.abs(t.v.x)))}function M(e){const a=new t(e.x,e.y),i=new n(a);d.push(i),i.draw(m)}y.showPanel(0),document.body.appendChild(y.dom);
